# 验收标准

## 1. GitHub Action基础功能验收

### 1.1 工作流文件存在性
**标准**：GitHub Action工作流文件必须存在且格式正确
- [ ] 工作流文件位于`.github/workflows/`目录下
- [ ] 文件名语义化（如`docker-build.yml`）
- [ ] YAML格式正确，无语法错误
- [ ] 必要的元数据字段完整（name、on、jobs等）

### 1.2 触发条件验证
**标准**：工作流必须按照预期条件触发
- [ ] 推送到main分支时自动触发
- [ ] 创建tag时自动触发（格式：v*）
- [ ] 支持手动触发（workflow_dispatch）
- [ ] 触发条件互不冲突，逻辑正确

### 1.3 权限配置验证
**标准**：工作流具有适当的权限配置
- [ ] 配置了必要的GitHub Token权限
- [ ] `contents: read`权限正确设置
- [ ] `packages: write`权限正确设置
- [ ] 权限范围最小化，不授予过多权限

## 2. Docker构建功能验收

### 2.1 构建环境配置
**标准**：构建环境必须正确配置
- [ ] 使用正确的Docker Buildx版本
- [ ] 多架构支持正确配置（linux/amd64, linux/arm64）
- [ ] 构建缓存正确启用
- [ ] 构建上下文路径正确

### 2.2 构建参数验证
**标准**：构建参数必须正确设置
- [ ] 基础镜像路径正确：`ghcr.io/astral-sh/uv:bookworm-slim`
- [ ] 构建目标正确（如果有多个target）
- [ ] Dockerfile路径正确：`./claude-code-proxy/Dockerfile`
- [ ] 构建参数传递正确

### 2.3 标签策略验证
**标准**：镜像标签必须按照策略正确应用
- [ ] 推送到main分支时标记为`latest`
- [ ] 基于commit hash的标签正确生成
- [ ] 基于git tag的标签正确生成
- [ ] 多架构镜像的manifest清单正确创建

## 3. 镜像推送功能验收

### 3.1 容器注册表配置
**标准**：必须正确配置GitHub容器注册表
- [ ] 容器注册表地址正确：`ghcr.io`
- [ ] 镜像命名规范：`ghcr.io/${{ github.repository }}/claude-code-proxy`
- [ ] 认证信息正确配置
- [ ] 推送权限正确设置

### 3.2 推送过程验证
**标准**：推送过程必须完整且成功
- [ ] 登录容器注册表成功
- [ ] 所有架构的镜像都成功推送
- [ ] Manifest清单正确推送
- [ ] 推送完成后提供可验证的digest信息

### 3.3 推送结果验证
**标准**：推送结果必须可验证
- [ ] 镜像在GitHub容器注册表中可见
- [ ] 镜像标签正确显示
- [ ] 镜像manifest信息正确
- [ ] 镜像大小信息合理

## 4. 性能和质量验收

### 4.1 构建性能
**标准**：构建性能必须达到预期
- [ ] 首次构建时间不超过15分钟
- [ ] 缓存构建时间不超过5分钟
- [ ] 多架构构建时间不超过20分钟
- [ ] 网络传输时间合理

### 4.2 构建质量
**标准**：构建的镜像必须质量良好
- [ ] 镜像大小合理优化
- [ ] 镜像能够正常启动
- [ ] 镜像包含所有必要文件
- [ ] 镜像无安全漏洞警告

### 4.3 可维护性
**标准**：工作流配置必须易于维护
- [ ] 配置结构清晰，逻辑明确
- [ ] 错误处理完善
- [ ] 日志输出详细且有用
- [ ] 易于修改和扩展

## 5. 安全性验收

### 5.1 安全配置
**标准**：安全配置必须正确
- [ ] 不包含敏感信息泄露
- [ ] 使用官方基础镜像
- [ ] 权限最小化原则
- [ ] 安全扫描通过

### 5.2 访问控制
**标准**：访问控制必须严格
- [ ] 只有授权用户能触发构建
- [ ] 只有授权分支能触发自动构建
- [ ] Token使用受限制
- [ ] 镜像访问权限正确设置

## 6. 监控和日志验收

### 6.1 监控能力
**标准**：必须具备监控能力
- [ ] 构建状态实时可见
- [ ] 失败原因明确显示
- [ ] 性能指标可追踪
- [ ] 告警机制有效

### 6.2 日志质量
**标准**：日志质量必须达到要求
- [ ] 每个步骤都有详细日志
- [ ] 错误日志信息明确
- [ ] 调试信息充分
- [ ] 日志格式规范统一

## 7. 集成测试验收

### 7.1 端到端测试
**标准**：必须通过端到端测试
- [ ] 从GitHub拉取镜像成功
- [ ] 镜像能够正常启动
- [ ] 应用基本功能正常
- [ ] 网络访问正常

### 7.2 回归测试
**标准**：必须通过回归测试
- [ ] 不破坏现有功能
- [ ] 兼容现有部署
- [ ] 性能不降低
- [ ] 安全性不降低

## 8. 文档验收

### 8.1 技术文档
**标准**：技术文档必须完整
- [ ] 工作流配置说明
- [ ] 使用指南
- [ ] 故障排除指南
- [ ] API文档

### 8.2 用户文档
**标准**：用户文档必须友好
- [ ] 快速开始指南
- [ ] 常见问题解答
- [ ] 最佳实践
- [ ] 示例代码

## 9. 故障处理验收

### 9.1 错误恢复
**标准**：必须具备错误恢复能力
- [ ] 构建失败时能正确回滚
- [ ] 提供重试机制
- [ ] 错误状态正确标记
- [ ] 通知机制有效

### 9.2 故障诊断
**标准**：必须易于故障诊断
- [ ] 错误信息明确
- [ ] 诊断工具可用
- [ ] 日志分析方便
- [ ] 支持信息充分

## 10. 扩展性验收

### 10.1 功能扩展
**标准**：必须支持功能扩展
- [ ] 易于添加新的构建目标
- [ ] 支持更多的架构类型
- [ ] 支持更多的标签策略
- [ ] 支持更多的部署环境

### 10.2 性能扩展
**标准**：必须支持性能扩展
- [ ] 支持并行构建
- [ ] 支持分布式构建
- [ ] 支持构建缓存扩展
- [ ] 支持负载均衡

## 测试检查清单

### 构建前检查
- [ ] 检查代码仓库结构
- [ ] 验证Dockerfile存在且正确
- [ ] 检查GitHub Actions配置
- [ ] 验证权限设置

### 构建中检查
- [ ] 监控构建进度
- [ ] 检查构建日志
- [ ] 验证缓存使用情况
- [ ] 监控资源使用

### 构建后检查
- [ ] 验证镜像推送成功
- [ ] 检查镜像标签
- [ ] 测试镜像功能
- [ ] 验证部署状态

### 长期监控
- [ ] 监控构建成功率
- [ ] 跟踪构建时间趋势
- [ ] 监控镜像大小变化
- [ ] 收集用户反馈